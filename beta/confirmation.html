<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Confirmation</title>

  <!-- shared styles (colors, fonts, buttons, resets) -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- page styles -->
  <link rel="stylesheet" href="css/confirmation.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/confirmation.css" />
</head>

<body class="confirmation-body">

  <main class="confirm-page">

    <!-- header -->
    <section class="confirm-hero">
      <h1 class="confirm-hero-title">Your Order Number is</h1>
      <div class="confirm-hero-number" id="orderNumber">32</div>

    <!-- MAP -->
    <img class="confirm-map"
         src="../assets/images/icons/map.png"
         alt="Map location" />
      <div class="confirm-address">
        <span class="confirm-pin">üìç</span>
        <span>11 N 33rd St, Philadelphia, PA 19104</span>
        <span class="confirm-ext">‚Üó</span>
      </div>
    </section>

    <!-- pickup status -->
    <section class="pickup-card">
      <div class="pickup-text">
        <p class="pickup-heading">Pickup Status</p>
        <p class="pickup-sub" id="readyByText">Est Ready by: 11:00am</p>
      </div>

      <div class="pickup-progress">
        <div class="progress-row">
          <span class="dot dot-active"></span>
          <span class="line"></span>
          <span class="dot"></span>
          <span class="line"></span>
          <span class="dot"></span>
        </div>

        <div class="progress-labels">
          <span class="progress-label">Received</span>
          <span class="progress-label">Preparing</span>
          <span class="progress-label">Completed</span>
        </div>
      </div>
    </section>

    <h2 class="order-title">Your Order</h2>

    <!-- Reuse your bag styles if you already have them.
         This HTML matches the same structure you used earlier -->
    <section class="order-card">
      <div class="order-item">
        <img class="order-img" src="../assets/images/menu/bs/egg_cheese.webp" alt="Egg & Cheese" />
    <!-- JS renders the simple order card(s) here -->
    <section id="confirmList" class="confirm-list"></section>

    <!-- bottom -->
    <div class="confirm-bottom">
      <section class="total-row">
        <span class="total-label">Total</span>
        <span class="total-value" id="confirmTotal">$0.00</span>
      </section>

      <a class="primary-btn" href="index.html" id="returnHomeBtn">Return Home</a>
    </div>

  </main>

  <script type="module">
    import { getCart, getLastOrder } from "js/app.js";

    const list = document.getElementById("confirmList");
    const totalEl = document.getElementById("confirmTotal");
    const orderNumEl = document.getElementById("orderNumber");
    const readyByText = document.getElementById("readyByText");

    // Prefer the saved snapshot from payment page
    const last = getLastOrder();
    const items = (last && Array.isArray(last.items)) ? last.items : getCart();

    if (last?.orderNumber) orderNumEl.textContent = String(last.orderNumber);
    if (last?.readyBy) readyByText.textContent = `Est Ready by: ${last.readyBy}`;

    if (!items || items.length === 0) {
      list.innerHTML = `<p class="confirm-empty">Your cart was empty.</p>`;
      totalEl.textContent = "$0.00";
    } else {
      list.innerHTML = items.map(item => {
        const price = Number(item.price || 0);
        const qty = Number(item.qty || 1);
        const lineTotal = price * qty;
        const subtitle = item.subtitle ? item.subtitle : "";

        return `
          <article class="confirm-card">
            <img class="confirm-card-img" src="${item.img}" alt="${item.name}" />
            <div class="confirm-card-body">
              <div class="confirm-card-top">
                <div class="confirm-card-text">
                  <p class="confirm-card-name">${item.name}</p>
                  ${subtitle ? `<p class="confirm-card-sub">${subtitle}</p>` : ``}
                </div>
                <p class="confirm-card-price">$${lineTotal.toFixed(2)}</p>
              </div>

              <p class="confirm-card-qty">Qty: ${qty}</p>
            </div>
          </article>
        `;
      }).join("");

      const total = (last && typeof last.total === "number")
        ? last.total
        : items.reduce((sum, item) => sum + (Number(item.price || 0) * (item.qty || 1)), 0);

      totalEl.textContent = `$${total.toFixed(2)}`;
    }
  </script>

</body>
</html>